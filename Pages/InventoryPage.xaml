<Page x:Class="ClinicManagementSystem.Pages.InventoryPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      FlowDirection="RightToLeft"
      Title="Inventory">

                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="📦 إدارة المخزون" FontSize="24" FontWeight="Bold" Foreground="#333"/>
                                        <TextBlock Text="إدارة الأدوية والأدوات الطبية" FontSize="14" Foreground="#666" Margin="0,5,0,0"/>
                                    </StackPanel>

                                    <Button Grid.Column="1" Content="➕ صنف جديد" Background="#4CAF50" Foreground="White" 
                        BorderThickness="0" Padding="20,10" FontSize="14" Cursor="Hand" Click="AddItem_Click"/>
                                </Grid>
                            </Border>

                            <!-- Stats & Filters -->
                            <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Stats -->
                                    <UniformGrid Grid.Row="0" Columns="4" Margin="0,0,0,15">
                                        <Border Background="#E3F2FD" CornerRadius="8" Padding="15" Margin="5">
                                            <StackPanel>
                                                <TextBlock Text="📊 إجمالي الأصناف" FontSize="12" Foreground="#1976D2"/>
                                                <TextBlock x:Name="txtTotalItems" Text="0" FontSize="24" FontWeight="Bold" 
                                       Foreground="#1976D2" Margin="0,5,0,0"/>
                                            </StackPanel>
                                        </Border>

                                        <Border Background="#FFEBEE" CornerRadius="8" Padding="15" Margin="5">
                                            <StackPanel>
                                                <TextBlock Text="⚠️ مخزون منخفض" FontSize="12" Foreground="#D32F2F"/>
                                                <TextBlock x:Name="txtLowStock" Text="0" FontSize="24" FontWeight="Bold" 
                                       Foreground="#D32F2F" Margin="0,5,0,0"/>
                                            </StackPanel>
                                        </Border>

                                        <Border Background="#FFF3E0" CornerRadius="8" Padding="15" Margin="5">
                                            <StackPanel>
                                                <TextBlock Text="⏰ قارب على الانتهاء" FontSize="12" Foreground="#F57C00"/>
                                                <TextBlock x:Name="txtExpiringSoon" Text="0" FontSize="24" FontWeight="Bold" 
                                       Foreground="#F57C00" Margin="0,5,0,0"/>
                                            </StackPanel>
                                        </Border>

                                        <Border Background="#E8F5E9" CornerRadius="8" Padding="15" Margin="5">
                                            <StackPanel>
                                                <TextBlock Text="💰 قيمة المخزون" FontSize="12" Foreground="#388E3C"/>
                                                <TextBlock x:Name="txtTotalValue" Text="0 جنيه" FontSize="20" FontWeight="Bold" 
                                       Foreground="#388E3C" Margin="0,5,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </UniformGrid>

                                    <!-- Search & Filters -->
                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox x:Name="txtSearch" Grid.Column="0" FontSize="14" Padding="10" 
                             VerticalContentAlignment="Center" TextChanged="txtSearch_TextChanged"/>

                                        <ComboBox x:Name="cmbCategoryFilter" Grid.Column="1" Width="150" Margin="10,0" 
                              FontSize="14" SelectionChanged="CategoryFilter_Changed">
                                            <ComboBoxItem Content="جميع الفئات" IsSelected="True"/>
                                            <ComboBoxItem Content="دواء"/>
                                            <ComboBoxItem Content="أداة طبية"/>
                                            <ComboBoxItem Content="مستهلكات"/>
                                            <ComboBoxItem Content="أخرى"/>
                                        </ComboBox>

                                        <Button Grid.Column="2" Content="📊 تصدير Excel" Background="#4CAF50" Foreground="White" 
                            BorderThickness="0" Padding="15,10" FontSize="14" Cursor="Hand" Click="ExportExcel_Click"/>
                                    </Grid>
                                </Grid>
                            </Border>

                            <!-- Inventory DataGrid -->
                            <Border Grid.Row="2" Background="White" CornerRadius="10" Padding="20">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                        <TextBlock Text="إجمالي: " FontSize="14" Foreground="#666" VerticalAlignment="Center"/>
                                        <TextBlock x:Name="txtTotalCount" Text="0" FontSize="14" FontWeight="Bold" 
                               Foreground="#2196F3" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                    </StackPanel>

                                    <DataGrid x:Name="dgInventory" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True"
                          GridLinesVisibility="None" HeadersVisibility="Column" Background="White"
                          RowBackground="#FAFAFA" AlternatingRowBackground="White" BorderThickness="0"
                          CanUserResizeColumns="True" SelectionMode="Single">

                                        <DataGrid.ColumnHeaderStyle>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background" Value="#F5F5F5"/>
                                                <Setter Property="Foreground" Value="#333"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                                <Setter Property="Padding" Value="10"/>
                                                <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                                <Setter Property="BorderBrush" Value="#E0E0E0"/>
                                            </Style>
                                        </DataGrid.ColumnHeaderStyle>

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="الكود" Binding="{Binding ItemCode}" Width="100"/>
                                            <DataGridTextColumn Header="اسم الصنف" Binding="{Binding ItemName}" Width="*"/>
                                            <DataGridTextColumn Header="الفئة" Binding="{Binding Category}" Width="100"/>
                                            <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}" Width="80">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsLowStock}" Value="True">
                                                                <Setter Property="Foreground" Value="Red"/>
                                                                <Setter Property="FontWeight" Value="Bold"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTextColumn Header="الحد الأدنى" Binding="{Binding MinimumStock}" Width="90"/>
                                            <DataGridTextColumn Header="السعر" Binding="{Binding UnitPrice, StringFormat='{}{0:N2}'}" Width="80"/>
                                            <DataGridTextColumn Header="المورد" Binding="{Binding SupplierName}" Width="120"/>
                                            <DataGridTextColumn Header="الصلاحية" Binding="{Binding ExpiryDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="100">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsExpiringSoon}" Value="True">
                                                                <Setter Property="Foreground" Value="#FF9800"/>
                                                                <Setter Property="FontWeight" Value="Bold"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>

                                            <DataGridTemplateColumn Header="الإجراءات" Width="200">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <Button Content="➕" Background="#4CAF50" Foreground="White"
                                                BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                Cursor="Hand" Click="AddStock_Click" Tag="{Binding ItemID}"
                                                ToolTip="إضافة كمية"/>

                                                            <Button Content="➖" Background="#FF9800" Foreground="White"
                                                BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                Cursor="Hand" Click="RemoveStock_Click" Tag="{Binding ItemID}"
                                                ToolTip="استهلاك"/>

                                                            <Button Content="✏️" Background="#2196F3" Foreground="White"
                                                BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                Cursor="Hand" Click="EditItem_Click" Tag="{Binding ItemID}"/>

                                                            <Button Content="🗑️" Background="#F44336" Foreground="White"
                                                BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                Cursor="Hand" Click="DeleteItem_Click" Tag="{Binding ItemID}"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Border>
                        </Grid>
                    </Page>