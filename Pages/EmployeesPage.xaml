<Page x:Class="ClinicManagementSystem.Pages.EmployeesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      FlowDirection="RightToLeft"
      Title="Employees">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="👔 إدارة الموظفين" FontSize="24" FontWeight="Bold" Foreground="#333"/>
                    <TextBlock Text="إضافة وإدارة الموظفين والمستخدمين" FontSize="14" Foreground="#666" Margin="0,5,0,0"/>
                </StackPanel>

                <Button Grid.Column="1" Content="➕ موظف جديد" Background="#3F51B5" Foreground="White" 
                        BorderThickness="0" Padding="20,10" FontSize="14" Cursor="Hand" Click="AddEmployee_Click"/>
            </Grid>
        </Border>

        <!-- Stats & Filters -->
        <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Stats -->
                <UniformGrid Grid.Row="0" Columns="4" Margin="0,0,0,15">
                    <Border Background="#3F51B5" CornerRadius="8" Padding="15" Margin="5">
                        <StackPanel>
                            <TextBlock Text="👥 إجمالي الموظفين" FontSize="12" Foreground="White"/>
                            <TextBlock x:Name="txtTotalEmployees" Text="0" FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <Border Background="#4CAF50" CornerRadius="8" Padding="15" Margin="5">
                        <StackPanel>
                            <TextBlock Text="👨‍⚕️ أطباء" FontSize="12" Foreground="White"/>
                            <TextBlock x:Name="txtDoctors" Text="0" FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <Border Background="#FF9800" CornerRadius="8" Padding="15" Margin="5">
                        <StackPanel>
                            <TextBlock Text="👨‍💼 إداريين" FontSize="12" Foreground="White"/>
                            <TextBlock x:Name="txtAdmins" Text="0" FontSize="28" FontWeight="Bold" 
                                       Foreground="White" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>

                    <Border Background="#E91E63" CornerRadius="8" Padding="15" Margin="5">
                        <StackPanel>
                            <TextBlock Text="💰 إجمالي الرواتب" FontSize="12" Foreground="White"/>
                            <TextBlock x:Name="txtTotalSalaries" Text="0 جنيه" FontSize="24" FontWeight="Bold" 
                                       Foreground="White" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </UniformGrid>

                <!-- Filters -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="txtSearch" Grid.Column="0" FontSize="14" Padding="10" 
                             VerticalContentAlignment="Center" TextChanged="txtSearch_TextChanged"/>

                    <ComboBox x:Name="cmbRoleFilter" Grid.Column="1" Width="150" Margin="10,0" 
                              FontSize="14" SelectionChanged="RoleFilter_Changed">
                        <ComboBoxItem Content="جميع الموظفين" IsSelected="True"/>
                        <ComboBoxItem Content="طبيب"/>
                        <ComboBoxItem Content="ممرض"/>
                        <ComboBoxItem Content="موظف استقبال"/>
                        <ComboBoxItem Content="مدير"/>
                        <ComboBoxItem Content="محاسب"/>
                    </ComboBox>

                    <Button Grid.Column="2" Content="📊 تصدير Excel" Background="#4CAF50" Foreground="White" 
                            BorderThickness="0" Padding="15,10" FontSize="14" Cursor="Hand" Click="ExportExcel_Click"/>
                </Grid>
            </Grid>
        </Border>

        <!-- Employees DataGrid -->
        <Border Grid.Row="2" Background="White" CornerRadius="10" Padding="20">
            <DataGrid x:Name="dgEmployees" AutoGenerateColumns="False" IsReadOnly="True"
                      GridLinesVisibility="None" HeadersVisibility="Column" Background="White"
                      RowBackground="#FAFAFA" AlternatingRowBackground="White" BorderThickness="0">

                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F5F5F5"/>
                        <Setter Property="Foreground" Value="#333"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="Padding" Value="10"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="الاسم الكامل" Binding="{Binding FullName}" Width="*"/>
                    <DataGridTextColumn Header="اسم المستخدم" Binding="{Binding Username}" Width="120"/>
                    <DataGridTextColumn Header="الوظيفة" Binding="{Binding Role}" Width="120"/>
                    <DataGridTextColumn Header="رقم الهاتف" Binding="{Binding PhoneNumber}" Width="120"/>
                    <DataGridTextColumn Header="البريد الإلكتروني" Binding="{Binding Email}" Width="200"/>
                    <DataGridTextColumn Header="الراتب" Binding="{Binding Salary, StringFormat='{}{0:N2}'}" Width="100"/>
                    <DataGridTextColumn Header="تاريخ التعيين" Binding="{Binding HireDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="120"/>

                    <DataGridTemplateColumn Header="الحالة" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="4" Padding="8,4">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Background" Value="#C8E6C9"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                    <Setter Property="Background" Value="#FFCDD2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToActiveConverter}}" 
                                               FontSize="11" FontWeight="Bold" HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="الإجراءات" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="👁️" Background="#2196F3" Foreground="White"
                                            BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                            Cursor="Hand" Click="ViewEmployee_Click" Tag="{Binding UserID}"/>
                                    <Button Content="✏️" Background="#FF9800" Foreground="White"
                                            BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                            Cursor="Hand" Click="EditEmployee_Click" Tag="{Binding UserID}"/>
                                    <Button Content="🔑" Background="#9C27B0" Foreground="White"
                                            BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                            Cursor="Hand" Click="ResetPassword_Click" Tag="{Binding UserID}"
                                            ToolTip="إعادة تعيين كلمة المرور"/>
                                    <Button Content="❌" Background="#F44336" Foreground="White"
                                            BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                            Cursor="Hand" Click="DeactivateEmployee_Click" Tag="{Binding UserID}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</Page>