<Page x:Class="ClinicManagementSystem.Pages.QueuePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      FlowDirection="RightToLeft"
      Title="Queue">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Side - Queue List -->
        <Grid Grid.Column="0" Margin="0,0,10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="20" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="🔢 نظام الدور - اليوم" FontSize="24" FontWeight="Bold" Foreground="#333"/>
                        <TextBlock x:Name="txtCurrentDate" Text="الأحد، 1 يناير 2025" 
                                   FontSize="14" Foreground="#666" Margin="0,5,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="➕ إضافة للدور" Background="#4CAF50" Foreground="White" 
                                BorderThickness="0" Padding="15,10" Margin="5,0" FontSize="14" 
                                Cursor="Hand" Click="AddToQueue_Click"/>
                        <Button Content="🔄 تحديث" Background="#2196F3" Foreground="White" 
                                BorderThickness="0" Padding="15,10" FontSize="14" 
                                Cursor="Hand" Click="Refresh_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Queue List -->
            <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Stats -->
                    <UniformGrid Grid.Row="0" Columns="3" Margin="0,0,0,20">
                        <Border Background="#E3F2FD" CornerRadius="8" Padding="15" Margin="5">
                            <StackPanel>
                                <TextBlock Text="⏳ منتظر" FontSize="12" Foreground="#1976D2"/>
                                <TextBlock x:Name="txtWaitingCount" Text="0" FontSize="28" 
                                           FontWeight="Bold" Foreground="#1976D2" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#FFF3E0" CornerRadius="8" Padding="15" Margin="5">
                            <StackPanel>
                                <TextBlock Text="👨‍⚕️ جاري الكشف" FontSize="12" Foreground="#F57C00"/>
                                <TextBlock x:Name="txtInProgressCount" Text="0" FontSize="28" 
                                           FontWeight="Bold" Foreground="#F57C00" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#E8F5E9" CornerRadius="8" Padding="15" Margin="5">
                            <StackPanel>
                                <TextBlock Text="✅ منتهي" FontSize="12" Foreground="#388E3C"/>
                                <TextBlock x:Name="txtCompletedCount" Text="0" FontSize="28" 
                                           FontWeight="Bold" Foreground="#388E3C" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>

                    <!-- Queue DataGrid -->
                    <DataGrid x:Name="dgQueue" Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True"
                              GridLinesVisibility="None" HeadersVisibility="Column" Background="White"
                              RowBackground="#FAFAFA" AlternatingRowBackground="White" BorderThickness="0"
                              SelectionMode="Single">

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#F5F5F5"/>
                                <Setter Property="Foreground" Value="#333"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Padding" Value="10"/>
                                <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                <Setter Property="BorderBrush" Value="#E0E0E0"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="الدور" Binding="{Binding QueueNumber}" Width="60">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="20"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="#2196F3"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTextColumn Header="اسم المريض" Binding="{Binding PatientName}" Width="*"/>
                            <DataGridTextColumn Header="نوع الكشف" Binding="{Binding VisitType}" Width="100"/>
                            <DataGridTextColumn Header="الوقت" Binding="{Binding VisitDate, StringFormat='{}{0:HH:mm}'}" Width="80"/>

                            <DataGridTemplateColumn Header="الحالة" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="4" Padding="8,4">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding VisitStatus}" Value="منتظر">
                                                            <Setter Property="Background" Value="#FFE082"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding VisitStatus}" Value="جاري الكشف">
                                                            <Setter Property="Background" Value="#81C784"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding VisitStatus}" Value="منتهي">
                                                            <Setter Property="Background" Value="#E0E0E0"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding VisitStatus}" FontSize="12" 
                                                       FontWeight="Bold" HorizontalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTemplateColumn Header="الإجراءات" Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="▶️ بدء" Background="#4CAF50" Foreground="White"
                                                    BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                    Cursor="Hand" Click="StartExamination_Click" 
                                                    Tag="{Binding VisitID}"/>

                                            <Button Content="✅ إنهاء" Background="#2196F3" Foreground="White"
                                                    BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                    Cursor="Hand" Click="CompleteExamination_Click" 
                                                    Tag="{Binding VisitID}"/>

                                            <Button Content="❌ إلغاء" Background="#F44336" Foreground="White"
                                                    BorderThickness="0" Padding="8,4" Margin="2" FontSize="12"
                                                    Cursor="Hand" Click="CancelVisit_Click" 
                                                    Tag="{Binding VisitID}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- Right Side - Current Patient -->
        <Grid Grid.Column="1" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Current Patient Card -->
            <Border Grid.Row="0" Background="#2196F3" CornerRadius="15" Padding="20" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="المريض الحالي" FontSize="14" Foreground="White" 
                               FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="txtCurrentQueueNumber" Text="--" FontSize="72" 
                               Foreground="White" FontWeight="Bold" HorizontalAlignment="Center"
                               Margin="0,10,0,0"/>
                    <TextBlock x:Name="txtCurrentPatientName" Text="لا يوجد" FontSize="16" 
                               Foreground="#E3F2FD" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Next Patient -->
            <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="التالي في الدور" FontSize="12" Foreground="#666" 
                               HorizontalAlignment="Center"/>
                    <TextBlock x:Name="txtNextQueueNumber" Text="--" FontSize="36" 
                               Foreground="#FF9800" FontWeight="Bold" HorizontalAlignment="Center"
                               Margin="0,5,0,0"/>
                    <TextBlock x:Name="txtNextPatientName" Text="لا يوجد" FontSize="13" 
                               Foreground="#666" HorizontalAlignment="Center" Margin="0,5,0,0"/>

                    <Button x:Name="btnCallNext" Content="📢 استدعاء التالي" 
                            Background="#FF9800" Foreground="White" BorderThickness="0" 
                            Padding="15,10" Margin="0,15,0,0" FontSize="14" FontWeight="Bold"
                            Cursor="Hand" Click="CallNext_Click"/>
                </StackPanel>
            </Border>

            <!-- Quick Actions -->
            <Border Grid.Row="2" Background="White" CornerRadius="10" Padding="15">
                <StackPanel>
                    <TextBlock Text="⚡ إجراءات سريعة" FontSize="14" FontWeight="Bold" 
                               Foreground="#333" Margin="0,0,0,15"/>

                    <Button Content="🔊 إعادة النداء" Background="#9C27B0" Foreground="White"
                            BorderThickness="0" Padding="15,10" Margin="0,5" FontSize="13"
                            Cursor="Hand" Click="RepeatCall_Click"/>

                    <Button Content="📋 تفاصيل المريض" Background="#00BCD4" Foreground="White"
                            BorderThickness="0" Padding="15,10" Margin="0,5" FontSize="13"
                            Cursor="Hand" Click="ViewPatientDetails_Click"/>

                    <Button Content="💊 روشتة جديدة" Background="#4CAF50" Foreground="White"
                            BorderThickness="0" Padding="15,10" Margin="0,5" FontSize="13"
                            Cursor="Hand" Click="NewPrescription_Click"/>

                    <Button Content="💰 إنشاء فاتورة" Background="#FF9800" Foreground="White"
                            BorderThickness="0" Padding="15,10" Margin="0,5" FontSize="13"
                            Cursor="Hand" Click="CreateInvoice_Click"/>

                    <Separator Margin="0,15"/>

                    <TextBlock Text="📊 إحصائيات اليوم" FontSize="12" Foreground="#999" 
                               Margin="0,10,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="إجمالي الزيارات: " FontSize="12" Foreground="#666"/>
                        <TextBlock x:Name="txtTotalVisits" Text="0" FontSize="12" 
                                   FontWeight="Bold" Foreground="#2196F3"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="متوسط وقت الانتظار: " FontSize="12" Foreground="#666"/>
                        <TextBlock x:Name="txtAverageWaitTime" Text="0 دقيقة" FontSize="12" 
                                   FontWeight="Bold" Foreground="#FF9800"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>